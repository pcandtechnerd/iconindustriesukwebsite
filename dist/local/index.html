<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Local UK Orders | ICON Industries UK</title>

  <!-- Bootstrap & Fonts -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />

  <!-- Icons -->
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="manifest" href="/site.webmanifest" />

  <!-- Theme & Meta -->
  <meta name="theme-color" content="#e0f2ff" />
  <meta name="robots" content="noindex, nofollow" />
  <meta name="googlebot" content="noindex, nofollow" />

  <!-- Content Security Policy -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline';
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdn.jsdelivr.net;
    font-src https://fonts.gstatic.com;
    img-src 'self' data:;
    connect-src 'self';
  " />

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #e6f4ff;
    }
    header {
      background-color: #ffffff;
      border-bottom: 1px solid #b3d9ff;
      padding: 1rem 0;
      font-size: 1.5rem;
      font-weight: 600;
      text-align: center;
      cursor: pointer;
      color: #0077cc;
    }
    h1 {
      font-weight: 600;
      color: #004080;
    }
    h2 {
      color: #005c99;
      font-size: 1.3rem;
      font-weight: 600;
      cursor: pointer;
      user-select: none;
    }
    h2:hover {
      color: #0077cc;
      text-decoration: underline;
    }
    p, li {
      color: #333;
    }
    .description {
      font-size: 1rem;
      color: #444;
    }
    input, button {
      margin-top: 1rem;
    }
    #result {
      margin-top: 1rem;
    }
    .dropdown-content {
      display: none;
      margin-top: 1rem;
      transition: all 0.3s ease;
      background-color: #f2fbff;
      padding: 1rem;
      border-radius: 8px;
      border: 1px solid #cce7ff;
    }
    .dropdown-content.show {
      display: block;
    }
    section {
      margin-bottom: 2rem;
    }
    footer {
      background-color: #004080;
      color: white;
      text-align: center;
      padding: 1rem 0;
    }
    .btn-primary {
      background-color: #4db8ff;
      border: none;
      border-radius: 50px;
      padding: 0.6rem 2rem;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(0, 123, 255, 0.2);
      transition: transform 0.1s ease-in-out, background-color 0.2s;
    }
    .btn-primary:hover {
      background-color: #3399ff;
    }
    .btn-primary:active {
      transform: scale(0.95);
    }
    .form-control {
      max-width: 300px;
    }
    /* Honeypot field hidden off screen */
    .honeypot {
      position: absolute;
      left: -9999px;
      visibility: hidden;
      height: 0;
      width: 0;
      overflow: hidden;
    }
  </style>
</head>
<body>
  <header onclick="window.location.href='https://www.iconindustries.co.uk/'">
    ICON INDUSTRIES UK
  </header>

  <main class="container py-5">
    <h1 class="text-center mb-4">Local UK Orders</h1>
    <p class="description text-center">
      Enter the first part of your postcode to check if you’re eligible for local delivery.
    </p>

    <form id="deliveryForm" class="d-flex flex-column align-items-center" onsubmit="return checkDelivery(event)">
      <input
        type="text"
        id="postcode"
        name="postcode"
        class="form-control text-center"
        placeholder="e.g. NW3..."
        maxlength="5"
        autocomplete="off"
        aria-label="Postcode prefix"
      />

      <!-- Honeypot field: bots might fill this but humans won't -->
      <input type="text" name="website" id="website" class="honeypot" tabindex="-1" autocomplete="off" />

      <button type="submit" class="btn btn-primary mt-2">Check Delivery Area</button>
      <div id="result" class="text-center mt-3" aria-live="polite" aria-atomic="true"></div>
    </form>

    <div class="mt-5">
      <section>
        <h2>Privacy Policy</h2>
        <p>
          All communication is conducted securely via Signal with a 4-week chat retention period for customer privacy and transparency.
        </p>
      </section>

      <section>
        <h2 onclick="t('legalDisclaimer')">Legal Disclaimer & Limitation of Liability</h2>
        <div id="legalDisclaimer" class="dropdown-content" aria-hidden="true">
          <p>
            ICON Industries UK provides delivery services in accordance with local regulations. Delivery availability is limited to specified postcode areas only.
          </p>
          <p>
            Customers agree to the terms and conditions at the time of placing an order. ICON Industries UK is not liable for delays caused by unforeseen circumstances.
          </p>
        </div>
      </section>

      <section>
        <h2 onclick="t('deliveryTerms')">Delivery Terms & Conditions</h2>
        <div id="deliveryTerms" class="dropdown-content" aria-hidden="true">
          <p>
            Delivery is only available within the specified postcode areas confirmed through this form.
          </p>
          <p>
            Orders must be placed at least 24 hours in advance. Delivery times may vary due to traffic or weather conditions.
          </p>
        </div>
      </section>

      <section>
        <h2 onclick="t('contactInfo')">Contact Information</h2>
        <div id="contactInfo" class="dropdown-content" aria-hidden="true">
          <p>
            For inquiries, please contact us via Signal at the link provided upon postcode confirmation.
          </p>
          <p>
            Alternatively, email support@iconindustries.co.uk.
          </p>
        </div>
      </section>
    </div>
  </main>

  <footer>
    &copy; 2025 ICON Industries UK
  </footer>

  <script>
    let lastSubmissionTime = 0;

    function splitHex(str){
      const parts = [];
      for(let i=0; i<str.length;){
        const step = Math.floor(Math.random()*2)+1;
        parts.push(str.substr(i, step));
        i += step;
      }
      return parts;
    }

    function decode(hexArr){
      return hexArr.map(h => String.fromCharCode(parseInt(h, 16))).join('');
    }

    function shuffle(arr) {
      for(let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function reconstruct(hexStr) {
      return decode(splitHex(hexStr));
    }

    function toggleDropdown(id){
      const el = document.getElementById(id);
      if(!el) return;
      if(el.classList.contains('show')){
        el.classList.remove('show');
        setTimeout(() => {
          if(!el.classList.contains('show')) el.style.display='none';
        }, 400);
      } else {
        el.style.display = 'block';
        setTimeout(() => el.classList.add('show'), 10);
      }
    }
    window.t = toggleDropdown;

    function checkDelivery(event) {
      if(event) event.preventDefault();

      const now = Date.now();
      if(now - lastSubmissionTime < 5000) {
        const resultEl = document.getElementById('result');
        resultEl.style.color = '#d32f2f';
        resultEl.textContent = "Please wait a few seconds before trying again.";
        return false;
      }
      lastSubmissionTime = now;

      const form = document.getElementById('deliveryForm');
      const inputEl = form.postcode;
      const honeypotEl = form.website;
      const resultEl = document.getElementById('result');

      if(honeypotEl.value) {
        resultEl.style.color = '#d32f2f';
        resultEl.textContent = "Bot detected. Submission blocked.";
        return false;
      }

      const fakePostcodes = shuffle([
        {p: reconstruct('4E57'), r: reconstruct('4E573120746F204E573131')},  // NW, NW1 to NW11
        {p: reconstruct('5357'), r: reconstruct('53573120746F2053573131')},  // SW, SW1 to SW11
        {p: reconstruct('4531'), r: reconstruct('453120746F20353131')}     // E1, E1 to 511
      ]);

      let val = (inputEl.value || '').trim().toUpperCase();
      const postcodeRegex = /^AL(?:[1-9]|10)$/;

      if(val === '') {
        resultEl.style.color = '#d32f2f';
        resultEl.textContent = `Please enter a valid postcode prefix (e.g. ${fakePostcodes[0].p}3).`;
        return false;
      }

      if(!val.startsWith('AL')) {
        resultEl.style.color = '#d32f2f';
        resultEl.innerHTML = `Sorry, delivery is only available locally in ${fakePostcodes[0].p} London. Redirecting...`;
        setTimeout(() => window.location.href = 'https://www.iconindustries.co.uk/', 3000);
        return false;
      }

      if(postcodeRegex.test(val)) {
        // Self-modifying function to confuse static analysis - kept for security/obfuscation
        const newCode = checkDelivery.toString()
          .replace(/shuffle\(\[[\s\S]*?\]\)/, `shuffle([
            {p: decodeHex('4E57'), r: decodeHex('4E573120746F204E573131')},
            {p: decodeHex('5357'), r: decodeHex('53573120746F2053573131')},
            {p: decodeHex('4531'), r: decodeHex('453120746F20353131')}
          ])`);
        try {
          eval('checkDelivery = ' + newCode);
        } catch(e) {}

        const signalUrl = reconstruct('68747470733A2F2F7369676E616C2E6D652F2365752F6D4E597678305F33744355454656626A5A43454A332D68677A695F6E544466704576557353775B4B525974676A79734D75394C4E504934666D5F4A65474C454437');
        const signalDownloadUrl = reconstruct('68747470733A2F2F7369676E616C2E6F72672F646F776E6C6F61642F');

        resultEl.style.color = '#004080';
        resultEl.innerHTML = `✅ You're in our delivery area!<br/>
          <a href="${signalUrl}" target="_blank" rel="noopener noreferrer">Contact us on Signal</a><br/>
          <small>Don't have Signal? <a href="${signalDownloadUrl}" target="_blank">Download here</a></small>`;

        return true;
      } else {
        resultEl.style.color = '#d32f2f';
        resultEl.textContent = `Please enter a postcode from ${fakePostcodes[0].r}.`;
        return false;
      }
    }
    window.c = checkDelivery;
  </script>
</body>
</html>
